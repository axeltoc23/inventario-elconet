{% extends "productos/base.html" %}

{% block title %}Gestionar {{ producto.nombre }}{% endblock %}

{% block content %}
    <h1>ğŸ“¦ Gestionar {{ producto.codigo }} - {{ producto.nombre }} - Stock: {{ producto.cantidad }} - UbicaciÃ³n: {{ producto.ubicacion }} - Alerta: {% if producto.alerta_activa %}
                âœ”ï¸ (MÃ­nimo: {{ producto.alerta_stock }})
            {% else %}
                âŒ
            {% endif %} - Estado: {% if producto.activo %}
                âœ… Activo
            {% else %}
                ğŸš« Desactivado
            {% endif %}</h1>

    {% if request.user.groups.all.0.name in "Administrador,Supervisor" %}
        <!-- Formulario de EdiciÃ³n de Producto -->
        <h2>âœï¸ Editar Producto</h2>
        <form method="post">
            {% csrf_token %}
            {{ producto_form.as_p }}
            <button type="submit" name="editar">Guardar cambios</button>
        </form>
        <hr>
    {% endif %}

    {% if request.user.groups.all.0.name in "Administrador,Supervisor,Almacen" %}
        {% if producto.activo %}
            <!-- Formulario para GestiÃ³n de Inventario -->
            <h2>ğŸ“Š GestiÃ³n de Inventario</h2>
            <form method="post">
                {% csrf_token %}
                {{ movimiento_form.as_p }}
                <button type="submit" name="movimiento">Registrar Movimiento</button>
            </form>
            <hr>
        {% else %}
            <p style="color: red;"><strong>ğŸš« Este producto estÃ¡ deshabilitado. No se pueden registrar movimientos.</strong></p>
            <hr>
        {% endif %}
    {% endif %}

    <!-- Historial de Movimientos (Visible para todos) -->
    <h2>ğŸ“œ Historial</h2>
    <ul>
        {% for movimiento in movimientos %}
            <li>
                ğŸ“… {{ movimiento.fecha|date:"d/m/Y H:i" }} -
                {{ movimiento.tipo|title }} de {{ movimiento.cantidad }} -
                ğŸ·ï¸ {{ movimiento.producto.codigo }} - {{ movimiento.nombre_producto }}
                {% if movimiento.comentario %} ğŸ“ ({{ movimiento.comentario }}){% endif %}
            </li>
        {% endfor %}
    </ul>

    <a href="{% url 'lista_productos' %}">â¬…ï¸ Volver</a>
{% endblock %}
